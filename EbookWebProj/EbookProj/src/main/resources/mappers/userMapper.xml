<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.spring.acorn.mapper.user">
 	<select id="login" parameterType ="user" resultType="user">
 		SELECT	USERID, PASSWORD, NAME, AGE, PHONE, GENRENUM, ADMIN
 		FROM		USERINFO
 		WHERE	USERID = #{userid} AND PASSWORD = #{password}
 	</select>
 	
 	<select id="oneuser" parameterType ="user" resultType="user">
 		SELECT	USERID, PASSWORD, NAME, AGE, PHONE, GENRENUM, ADMIN
 		FROM		USERINFO
 		WHERE	USERID = #{userid}
 	</select>
 	
 	<select id="putlist" parameterType="user" resultType="putlistboard">
 	 	SELECT		USERID, PUTDATE, TITLE, AUTHOR, GENRENAME, TAG, LIKECNT
 		FROM		USERBOOK
 		LEFT JOIN	BOOKINFO  USING(BOOKNUM)
 		LEFT JOIN	GENRE USING(GENRENUM)
 		WHERE		USERID = #{userid}
 		ORDER BY	PUTDATE ASC
 	</select>
 	
 	<select id="readlist" parameterType="user" resultType="readlistboard">
 	 	SELECT		USERID, READDATE, TITLE, AUTHOR, GENRENAME, TAG, LIKECNT
 		FROM		RECODE
 		LEFT JOIN	BOOKINFO  USING(BOOKNUM)
 		LEFT JOIN	GENRE USING(GENRENUM)
 		WHERE		USERID = #{userid}
 		ORDER BY	READDATE ASC
 	</select>
 	
 	<update id="update"
 			parameterType="user">
 		UPDATE	USERINFO
 		SET		PASSWORD = #{password},
 				NAME = #{name},
 				AGE = #{age},
 				PHONE = #{phone}
 		WHERE	USERID = #{userid}
 	</update>
 	
 	<delete id="withdrawal" parameterType ="user">
 	 	DELETE
 	 	FROM	USERINFO
 	 	WHERE	USERID = #{userid}
 	 	
<<<<<<< HEAD
 	</delete>
=======
 	</select>

 	<insert id="insert"
 			parameterType="user">
 		INSERT INTO USERINFO
 		VALUES(	#{userid},
 				#{password},
 				#{name},
 				#{age},
 				#{phone},
 				'01',
 				'0'
 		)
 	</insert>			

 	
 	 <select id="recom" parameterType="user" resultType="recomlist">
 		SELECT		BOOKNUM, TITLE, GENRENUM
		FROM		BOOKINFO 
		WHERE		GENRENUM IN (	SELECT REGEXP_SUBSTR(U.CONT, <![CDATA[ '[^|]+' ]]>, 1, LEVEL) CONT
													FROM (SELECT GENRENUM CONT
																FROM USERINFO
																WHERE USERID = #{userid} )U
													CONNECT BY LEVEL <![CDATA[ <=   ]]> length(REGEXP_REPLACE(U.CONT, '[^|]+',''))+1)
 	
 	</select>

 	
>>>>>>> 5d74f5da79859aa0197dfc9e109b4f6e19a39f45
</mapper>

